{
    "collab_server" : "",
    "contents" : "setwd(\"U:/Documents/My Research (UGA)/Multiple Hypoetheses/Article-1\")\n\nlibrary(IHW)\nlibrary(IHWpaper)\nlibrary(OPWeight)   # proposed library\nlibrary(dplyr)      # group_by function\nlibrary(reshape2)   # melt\nlibrary(ggplot2)    # ggplot\nlibrary(cowplot)    # nice plots\nlibrary(MASS)       # box-cox transformation\nlibrary(gridExtra)  # grid.arrange fucntion\nlibrary(DESeq2)     # RNA-seq analysis\n\n\n# data processing\n#-------------------------\nbottomly_count_table <- read.table(\"bottomly_count_table.txt\",h=T)\nbottomly_phenodata <- read.table(\"bottomly_phenodata.txt\",h=T)\ncountData <- as.matrix(bottomly_count_table[,-1])\t\t# counts\ncondition <- factor(bottomly_phenodata[,3])\t\t\t\t# strain as factor\ndds <- DESeqDataSetFromMatrix(countData, DataFrame(condition), ~ condition)\ndds <- DESeq(dds)\nbottomly <- as.data.frame(results(dds))\ncolnames(bottomly)\n\n\ntests = bottomly$stat\npvals = bottomly$pvalue\nfilters = bottomly$baseMean\n\nData <- tibble(test=tests, pval=pvals, filter=filters)\t# data of filter covariate and pvlaues\n\n# summary statistics plots of the data\n#---------------------------------------------\nbarlines <- \"#1F3552\"\n\nhist_test <- ggplot(Data, aes(x = Data$test)) +\n    geom_histogram(aes(y = ..density..), binwidth = 1,\n                   colour = barlines, fill = \"#4271AE\") +\n    labs(x = \"test statistics\")\n\nhist_pval <- ggplot(Data, aes(x = Data$pval)) +\n    geom_histogram(aes(y = ..density..),\n                   colour = barlines, fill = \"#4281AE\")+\n    labs(x = \"pvalues\")\n\nhist_filter <- ggplot(Data, aes(x = Data$filter)) +\n    geom_histogram(aes(y = ..density..),\n                   colour = barlines, fill = \"#4274AE\") +\n    labs(x = \"filter statistics\")\n\ntest_filter <- ggplot(Data, aes(x = Data$test, y = Data$filter)) +\n    geom_point() + labs(x = \"test statstics\", y = \"filter statistics\")\n#scale_x_continuous(limits = c(0, 25000), breaks=seq(0, 25000, 10000))\n\npval_filter <- ggplot(Data, aes(x = rank(-Data$filter), y = -log10(pval))) +\n    geom_point()+\n    labs(x = \"ranks of filters\", y = \"-log(pvalue)\")+\n    scale_x_continuous(limits = c(0, 25000), breaks=seq(0, 25000, 10000))\n\np_ecdf <- ggplot(Data, aes(x = pval)) +\n    stat_ecdf(geom = \"step\")+\n    labs(x = \"pvalues\", title=\"empirical cumulative distribution\")+\n    theme(plot.title = element_text(size = rel(.7)))\n\n\nsum_plots <- grid.arrange(hist_test,  hist_pval, hist_filter, test_filter , pval_filter, p_ecdf,\n                          ncol = 3, heights = c(7, 7), top = \"bottomly: data summary\")\nsum_plots\n\n\n# applying proposed methods------------\nn_rej_cont <- NULL\nn_rej_bin <- NULL\nfor(alphaVal in seq(.05, .1, length = 5))\n{\n    res_cont = opw(pvalue = pvals, filter = filters, test = tests, effectType = \"continuous\",\n                   alpha = alphaVal, tail=2, method = \"BH\")\n    res_bin = opw(pvalue = pvals, filter = filters, test = tests, effectType = \"binary\",\n                  alpha = alphaVal, tail=2, method = \"BH\")\n    n_rej_cont <- c(n_rej_cont, res_cont$rejections)\n    n_rej_bin <- c(n_rej_bin, res_bin$rejections)\n}\n\n\n# from IHW paper-------------\nalpha = seq(.05, .1, length = 5)\nbottomly_file <- system.file(\"real_data_examples/result_files\", \"bottomly_benchmark.Rds\", package = \"IHWpaper\")\nbottomly_data <- readRDS(file=bottomly_file)\npanel_c_data <- group_by(bottomly_data$alpha_df, alpha) %>%\n    summarize(BH = max(bh_rejections), IHW=max(rejections))\n\n\n# rejected test from different methods-------------\nrej_mat_bot_FDR <- data.frame(n_rej_bin, n_rej_cont, panel_c_data)\ncolnames(rej_mat_bot_FDR) <- c(\"PRO_bin\",\"PRO_cont\", \"alpha\", \"BH\",\"IHW\")\nrej_mat_bot_FDR2 <- melt(rej_mat_bot_FDR, id.var = \"alpha\")\n\np_fdr_bot <- ggplot(rej_mat_bot_FDR2, aes(x = alpha, y = value, group = variable,\n                                            colour = variable)) +\n    geom_line(aes(linetype = variable), size = 1.5) +\n    labs(x = \"alpha\", y = \"discoveries\", title = \"bottomly data\") +\n    theme(legend.title = element_blank(), legend.position=\"bottom\")\n\np_fdr_bot\n\n# save the results-------------------\nsave.image(\"bottomly_data_example.RDATA\")\n\n",
    "created" : 1493823198527.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "",
    "hash" : "3546189160",
    "id" : "86A3E2C",
    "lastKnownWriteTime" : 1493826351,
    "last_content_update" : 1493826328022,
    "path" : "U:/Documents/My Research (UGA)/Multiple Hypoetheses/Article-1/bottomly_data_example.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}